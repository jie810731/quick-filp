import requests
from funcy import pluck
import json
import numpy as np

def getAssets(contract ,offset = 0):
    url = 'https://api.opensea.io/api/v1/assets?limit=50&asset_contract_address={}&offset={}&format=json'.format(contract.strip(),offset)
    print('get assets, url={}'.format(url))
    header = { 
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36",
    }
    try:
        res = requests.get(url=url, headers=header)
        data = res.json()
    except Exception as ex:
        print('error')
        print(ex)
        pass

    return data

if __name__ == '__main__':
    test = [1,2,3,4,5]
    abc = test[-6:]
    print(abc)
    quit()

    contract_address = '0x90cfce78f5ed32f9490fd265d16c77a8b5320bd4'
    # data = getAssets(contract_address)
    # result =[]
    # assets = data['assets']

    # is_get_data = True
    # while is_get_data:
    #     data = getAssets(contract_address,len(assets))
    #     try:
    #         tmp = data['assets']
    #         assets = assets + data['assets']
    
    #         if not data['assets']:
    #             is_get_data = False

    #     except KeyError:
    #         is_get_data = False        

    # token_ids = list(pluck("token_id", assets))

    token_ids = ['99', '98', '97', '96', '95', '94', '93', '92', '91', '90', '9', '89', '88', '87', '86', '85', '84', '83', '82', '81', '80', '8', '79', '78', '776', '775', '774', '773', '772', '771', '770', '77', '769', '768', '767', '766', '765', '764', '763', '762', '761', '760', '76', '759', '758', '757', '756', '755', '754', '753', '752', '751', '750', '75', '749', '748', '747', '746', '745', '744', '743', '742', '741', '740', '74', '739', '738', '737', '736', '735', '734', '733', '732', '731', '730', '73', '729', '728', '727', '726', '725', '724', '723', '722', '721', '720', '72', '719', '718', '717', '716', '715', '714', '713', '712', '711', '710', '71', '709', '708', '707', '706', '705', '704', '703', '702', '701', '700', '70', '7', '699', '698', '697', '696', '695', '694', '693', '692', '691', '690', '69', '689', '688', '687', '686', '685', '684', '683', '682', '681', '680', '68', '679', '678', '677', '676', '675', '674', '673', '672', '671', '670', '67', '669', '668', '667', '666', '665', '664', '663', '662', '661', '660', '66', '659', '658', '657', '656', '655', '654', '653', '652', '651', '650', '65', '649', '648', '647', '646', '645', '644', '643', '642', '641', '640', '64', '639', '638', '637', '636', '635', '634', '633', '632', '631', '630', '63', '629', '628', '627', '626', '625', '624', '623', '622', '621', '620', '62', '619', '618', '617', '616', '615', '614', '613', '612', '611', '610', '61', '609', '608', '607', '606', '605', '604', '603', '602', '601', '600', '60', '6', '599', '598', '597', '596', '595', '594', '593', '592', '591', '590', '59', '589', '588', '587', '586', '585', '584', '583', '582', '581', '580', '58', '579', '578', '577', '576', '575', '574', '573', '572', '571', '570', '57', '569', '568', '567', '566', '565', '564', '563', '562', '561', '560', '56', '559', '558', '557', '556', '555', '554', '553', '552', '551', '550', '55', '549', '548', '547', '546', '545', '544', '543', '542', '541', '540', '54', '539', '538', '537', '536', '535', '534', '533', '532', '531', '530', '53', '529', '528', '527', '526', '525', '524', '523', '522', '521', '520', '52', '519', '518', '517', '516', '515', '514', '513', '512', '511', '510', '51', '509', '508', '507', '506', '505', '504', '503', '502', '501', '500', '50', '5', '499', '498', '497', '496', '495', '494', '493', '492', '491', '490', '49', '489', '488', '487', '486', '485', '484', '483', '482', '481', '480', '48', '479', '478', '477', '476', '475', '474', '473', '472', '471', '470', '47', '469', '468', '467', '466', '465', '464', '463', '462', '461', '460', '46', '459', '458', '457', '456', '455', '454', '453', '452', '451', '450', '45', '449', '448', '447', '446', '445', '444', '443', '442', '441', '440', '44', '439', '438', '437', '436', '435', '434', '433', '432', '431', '430', '43', '429', '428', '427', '426', '425', '424', '423', '422', '421', '420', '42', '419', '418', '417', '416', '415', '414', '413', '412', '411', '410', '41', '409', '408', '407', '406', '405', '404', '403', '402', '401', '400', '40', '4', '399', '398', '397', '396', '395', '394', '393', '392', '391', '390', '39', '389', '388', '387', '386', '385', '384', '383', '382', '381', '380', '38', '379', '378', '377', '376', '375', '374', '373', '372', '371', '370', '37', '369', '368', '367', '366', '365', '364', '363', '362', '361', '360', '36', '359', '358', '357', '356', '355', '354', '353', '352', '351', '350', '35', '349', '348', '347', '346', '345', '344', '343', '342', '341', '340', '34', '339', '338', '337', '336', '335', '334', '333', '332', '331', '330', '33', '329', '328', '327', '326', '325', '324', '323', '322', '321', '320', '32', '319', '318', '317', '316', '315', '314', '313', '312', '311', '310', '31', '309', '308', '307', '306', '305', '304', '303', '302', '301', '300', '30', '3', '299', '298', '297', '296', '295', '294', '293', '292', '291', '290', '29', '289', '288', '287', '286', '285', '284', '283', '282', '281', '280', '28', '279', '278', '277', '276', '275', '274', '273', '272', '271', '270', '27', '269', '268', '267', '266', '265', '264', '263', '262', '261', '260', '26', '259', '258', '257', '256', '255', '254', '253', '252', '251', '250', '25', '249', '248', '247', '246', '245', '244', '243', '242', '241', '240', '24', '239', '238', '237', '236', '235', '234', '233', '232', '231', '230', '23', '229', '228', '227', '226', '225', '224', '223', '222', '221', '220', '22', '219', '218', '217', '216', '215', '214', '213', '212', '211', '210', '21', '209', '208', '207', '206', '205', '204', '203', '202', '201', '200', '20', '2', '199', '198', '197', '196', '195', '194', '193', '192', '191', '190', '19', '189', '188', '187', '186', '185', '184', '183', '182', '181', '180', '18', '179', '178', '177', '176', '175', '174', '173', '172', '171', '170', '17', '169', '168', '167', '166', '165', '164', '163', '162', '161', '160', '16', '159', '158', '157', '156', '155', '154', '153', '152', '151', '150', '15', '149', '148', '147', '146', '145', '144', '143', '142', '141', '140', '14', '139', '138', '137', '136', '135', '134', '133', '132', '131', '130', '13', '129', '128', '127', '126', '125', '124', '123', '122', '121', '120', '12', '119', '118', '117', '116', '115', '114', '113', '112', '111', '110', '11', '109', '108', '107', '106', '105', '104', '103', '102', '101', '100', '10', '1', '0']
    np_array = np.array(token_ids)

    useful_data = {}
    offset_count  = 30
    index = 0
    while index <= len(token_ids):
        test = np_array[:30]

        params = {
            'token_ids': test,
            'asset_contract_address':contract_address,
            'sale_kind':0,
            'side':1,
            'order_by':"eth_price",
            'order_direction':'asc'
        }

        
        header = { 
            "X-API-KEY": "",
        }
        url = 'https://api.opensea.io/wyvern/v1/orders'
    
        res = requests.get(url=url, params=params,headers=header)

        if res.status_code == 200:
            data = res.json()

            for order_object in data['orders']:
                token_id = order_object['asset']['token_id']
                base_price = order_object['base_price']
            
                print(token_id)
                print(base_price)

                try:
                    current_price = useful_data[token_id]
                    if base_price < current_price:
                        useful_data[token_id] = base_price
                except KeyError as e:
                    useful_data[token_id] = base_price
                print(useful_data)
                break
        else:
            content = res.content
            print(res.content)
    

    # f = open("{}.txt".format('test/123'),"w")
    # f.write(json.dumps(data))
    # f.close()